// var dataNew = '[{    "contributionFYP" : "9.3%",    "contributionRECRUIT" : "13.2%",    "contributionACTIVEAGENTS" : "11.1%",    "actual" : {      "AGENTS" : "2518.0",      "ACTIVENEW" : "83.0",      "CASES" : "9.7900",      "CASESIZEFYC" : "6030.5",      "ANP" : "3.124849951E7",      "CASESIZEFYP" : "18757.41",      "FYC" : "1.049910233E7",      "FYP" : "3.265665958E7",      "RECRUIT" : "35.0",      "CASESIZEANP" : "17948.59",      "ACTIVEAGENTS" : "177.75"    },    "contributionANP" : "9.7%",    "contributionFYC" : "9.8%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "29.6600",      "ACTIVENEW" : "22.0600",      "CASES" : "-25.6600",      "CASESIZEFYC" : "5.4400",      "ANP" : "-2.0500",      "CASESIZEFYP" : "9.4600",      "FYC" : "-1.1400",      "FYP" : "2.6200",      "RECRUIT" : "40.0000",      "CASESIZEANP" : "4.4700",      "ACTIVEAGENTS" : "26.0600"    },    "code" : "7A",    "level" : "SZ", "type" : "SZ",   "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "10.8%",    "contributionACTIVENEW" : "10.6%",    "name" : "7A"  },  {    "contributionFYP" : "11.5%",    "contributionRECRUIT" : "10.9%",    "contributionACTIVEAGENTS" : "11.0%",    "actual" : {      "AGENTS" : "2586.0",      "ACTIVENEW" : "96.0",      "CASES" : "10.3800",      "CASESIZEFYC" : "7484.17",      "ANP" : "4.110954899E7",      "CASESIZEFYP" : "22211.77",      "FYC" : "1.365861952E7",      "FYP" : "4.053649551E7",      "RECRUIT" : "29.0",      "CASESIZEANP" : "22525.78",      "ACTIVEAGENTS" : "175.75"    },    "contributionANP" : "12.7%",    "contributionFYC" : "12.7%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "27.2000",      "ACTIVENEW" : "28.0000",      "CASES" : "-35.2100",      "CASESIZEFYC" : "28.0300",      "ANP" : "5.1200",      "CASESIZEFYP" : "30.5000",      "FYC" : "6.7900",      "FYP" : "8.8500",      "RECRUIT" : "16.0000",      "CASESIZEANP" : "26.0300",      "ACTIVEAGENTS" : "28.7500"    },    "code" : "7B",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "11.0%",    "contributionACTIVENEW" : "12.3%",    "name" : "7B"  },  {    "contributionFYP" : "9.6%",    "contributionRECRUIT" : "12.8%",    "contributionACTIVEAGENTS" : "8.2%",    "actual" : {      "AGENTS" : "1843.0",      "ACTIVENEW" : "82.0",      "CASES" : "10.9500",      "CASESIZEFYC" : "7507.18",      "ANP" : "3.099213039E7",      "CASESIZEFYP" : "23318.05",      "FYC" : "1.081034899E7",      "FYP" : "3.357800299E7",      "RECRUIT" : "34.0",      "CASESIZEANP" : "21522.31",      "ACTIVEAGENTS" : "131.5"    },    "contributionANP" : "9.6%",    "contributionFYC" : "10.1%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "26.9300",      "ACTIVENEW" : "28.1300",      "CASES" : "-13.7800",      "CASESIZEFYC" : "28.2400",      "ANP" : "15.7500",      "CASESIZEFYP" : "22.8600",      "FYC" : "38.4300",      "FYP" : "32.6200",      "RECRUIT" : "36.0000",      "CASESIZEANP" : "7.2300",      "ACTIVEAGENTS" : "25.2400"    },    "code" : "7C",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "7.9%",    "contributionACTIVENEW" : "10.5%",    "name" : "7C"  },  {    "contributionFYP" : "9.5%",    "contributionRECRUIT" : "10.2%",    "contributionACTIVEAGENTS" : "9.9%",    "actual" : {      "AGENTS" : "2340.0",      "ACTIVENEW" : "80.0",      "CASES" : "9.7300",      "CASESIZEFYC" : "6811.45",      "ANP" : "3.206376636E7",      "CASESIZEFYP" : "21675.08",      "FYC" : "1.047601839E7",      "FYP" : "3.333628688E7",      "RECRUIT" : "27.0",      "CASESIZEANP" : "20847.7",      "ACTIVEAGENTS" : "158.0"    },    "contributionANP" : "9.9%",    "contributionFYC" : "9.7%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "30.4300",      "ACTIVENEW" : "26.9800",      "CASES" : "-26.0600",      "CASESIZEFYC" : "6.2000",      "ANP" : "1.0600",      "CASESIZEFYP" : "10.3800",      "FYC" : "-1.9000",      "FYP" : "1.9600",      "RECRUIT" : "22.7300",      "CASESIZEANP" : "9.4000",      "ACTIVEAGENTS" : "24.9000"    },    "code" : "7D",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "10.0%",    "contributionACTIVENEW" : "10.3%",    "name" : "7D"  },  {    "contributionFYP" : "11.7%",    "contributionRECRUIT" : "6.8%",    "contributionACTIVEAGENTS" : "8.0%",    "actual" : {      "AGENTS" : "1757.0",      "ACTIVENEW" : "35.0",      "CASES" : "9.0900",      "CASESIZEFYC" : "7869.68",      "ANP" : "2.701853948E7",      "CASESIZEFYP" : "34908.03",      "FYC" : "9231138.21",      "FYP" : "4.094712392E7",      "RECRUIT" : "18.0",      "CASESIZEANP" : "23033.7",      "ACTIVEAGENTS" : "129.0"    },    "contributionANP" : "8.4%",    "contributionFYC" : "8.6%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "27.6900",      "ACTIVENEW" : "25.0000",      "CASES" : "-37.3100",      "CASESIZEFYC" : "0.3900",      "ANP" : "-19.4400",      "CASESIZEFYP" : "60.8900",      "FYC" : "-21.9100",      "FYP" : "25.1500",      "RECRUIT" : "12.5000",      "CASESIZEANP" : "3.5700",      "ACTIVEAGENTS" : "24.0400"    },    "code" : "7E",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "7.5%",    "contributionACTIVENEW" : "4.5%",    "name" : "7E"  },  {    "contributionFYP" : "6.1%",    "contributionRECRUIT" : "4.5%",    "contributionACTIVEAGENTS" : "4.6%",    "actual" : {      "AGENTS" : "1047.0",      "ACTIVENEW" : "33.0",      "CASES" : "11.0700",      "CASESIZEFYC" : "8175.71",      "ANP" : "2.014030566E7",      "CASESIZEFYP" : "25893.05",      "FYC" : "6720433.78",      "FYP" : "2.128409126E7",      "RECRUIT" : "12.0",      "CASESIZEANP" : "24501.58",      "ACTIVEAGENTS" : "74.25"    },    "contributionANP" : "6.2%",    "contributionFYC" : "6.3%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "41.3000",      "ACTIVENEW" : "50.0000",      "CASES" : "-20.5900",      "CASESIZEFYC" : "75.9400",      "ANP" : "84.5100",      "CASESIZEFYP" : "71.6200",      "FYC" : "85.1800",      "FYP" : "80.6300",      "RECRUIT" : "50.0000",      "CASESIZEANP" : "75.3100",      "ACTIVEAGENTS" : "32.5900"    },    "code" : "7F",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "4.5%",    "contributionACTIVENEW" : "4.2%",    "name" : "7F"  },  {    "contributionFYP" : "15.2%",    "contributionRECRUIT" : "19.2%",    "contributionACTIVEAGENTS" : "17.3%",    "actual" : {      "AGENTS" : "3889.0",      "ACTIVENEW" : "182.0",      "CASES" : "11.3000",      "CASESIZEFYC" : "5039.65",      "ANP" : "4.870327204E7",      "CASESIZEFYP" : "17028.15",      "FYC" : "1.581946354E7",      "FYP" : "5.345138046E7",      "RECRUIT" : "51.0",      "CASESIZEANP" : "15515.53",      "ACTIVEAGENTS" : "277.75"    },    "contributionANP" : "15.1%",    "contributionFYC" : "14.7%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "18.3100",      "ACTIVENEW" : "34.8100",      "CASES" : "-24.3100",      "CASESIZEFYC" : "8.2600",      "ANP" : "-2.1200",      "CASESIZEFYP" : "15.6700",      "FYC" : "-2.1200",      "FYP" : "4.5700",      "RECRUIT" : "27.5000",      "CASESIZEANP" : "8.2600",      "ACTIVEAGENTS" : "19.4600"    },    "code" : "7G",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "16.6%",    "contributionACTIVENEW" : "23.3%",    "name" : "7G"  },  {    "contributionFYP" : "13.6%",    "contributionRECRUIT" : "10.9%",    "contributionACTIVEAGENTS" : "12.3%",    "actual" : {      "AGENTS" : "3060.0",      "ACTIVENEW" : "83.0",      "CASES" : "9.3500",      "CASESIZEFYC" : "8012.84",      "ANP" : "4.47481927E7",      "CASESIZEFYP" : "25902.38",      "FYC" : "1.478370189E7",      "FYP" : "4.778989875E7",      "RECRUIT" : "29.0",      "CASESIZEANP" : "24253.76",      "ACTIVEAGENTS" : "197.25"    },    "contributionANP" : "13.8%",    "contributionFYC" : "13.8%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "26.0300",      "ACTIVENEW" : "36.0700",      "CASES" : "-31.5000",      "CASESIZEFYC" : "21.5000",      "ANP" : "12.7100",      "CASESIZEFYP" : "20.9600",      "FYC" : "7.1500",      "FYP" : "6.6800",      "RECRUIT" : "16.0000",      "CASESIZEANP" : "27.8000",      "ACTIVEAGENTS" : "28.7100"    },    "code" : "7H",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "13.1%",    "contributionACTIVENEW" : "10.6%",    "name" : "7H"  },  {    "contributionFYP" : "6.8%",    "contributionRECRUIT" : "4.9%",    "contributionACTIVEAGENTS" : "7.7%",    "actual" : {      "AGENTS" : "1924.0",      "ACTIVENEW" : "58.0",      "CASES" : "8.4400",      "CASESIZEFYC" : "7721.04",      "ANP" : "2.439485414E7",      "CASESIZEFYP" : "23162.15",      "FYC" : "8006721.04",      "FYP" : "2.401915512E7",      "RECRUIT" : "13.0",      "CASESIZEANP" : "23524.44",      "ACTIVEAGENTS" : "122.75"    },    "contributionANP" : "7.5%",    "contributionFYC" : "7.4%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "33.9800",      "ACTIVENEW" : "34.8800",      "CASES" : "-31.4400",      "CASESIZEFYC" : "6.3400",      "ANP" : "-3.4300",      "CASESIZEFYP" : "11.0300",      "FYC" : "-5.9900",      "FYP" : "-1.8500",      "RECRUIT" : "0.0000",      "CASESIZEANP" : "9.2400",      "ACTIVEAGENTS" : "28.8700"    },    "code" : "7I",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "8.2%",    "contributionACTIVENEW" : "7.4%",    "name" : "7I"  },  {    "contributionFYP" : "6.7%",    "contributionRECRUIT" : "6.8%",    "contributionACTIVEAGENTS" : "9.9%",    "actual" : {      "AGENTS" : "2438.0",      "ACTIVENEW" : "48.0",      "CASES" : "9.4700",      "CASESIZEFYC" : "4951.74",      "ANP" : "2.294206019E7",      "CASESIZEFYP" : "15644.71",      "FYC" : "7487039.79",      "FYP" : "2.365481052E7",      "RECRUIT" : "18.0",      "CASESIZEANP" : "15173.32",      "ACTIVEAGENTS" : "159.5"    },    "contributionANP" : "7.1%",    "contributionFYC" : "7.0%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "33.8800",      "ACTIVENEW" : "23.0800",      "CASES" : "-27.6000",      "CASESIZEFYC" : "4.6700",      "ANP" : "-4.8500",      "CASESIZEFYP" : "9.9800",      "FYC" : "-2.0600",      "FYP" : "2.9000",      "RECRUIT" : "12.5000",      "CASESIZEANP" : "1.7000",      "ACTIVEAGENTS" : "29.1500"    },    "code" : "7J",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "10.4%",    "contributionACTIVENEW" : "6.2%",    "name" : "7J"  },  {    "contributionFYP" : "0.0%",    "contributionRECRUIT" : "0.0%",    "contributionACTIVEAGENTS" : "0.0%",    "actual" : {      "AGENTS" : "8.0",      "ACTIVENEW" : "0.0",      "CASES" : "2.0000",      "CASESIZEFYC" : "3486.2",      "ANP" : "7923.2",      "CASESIZEFYP" : "7923.2",      "FYC" : "3486.2",      "FYP" : "7923.2",      "RECRUIT" : "0.0",      "CASESIZEANP" : "7923.2",      "ACTIVEAGENTS" : "0.5"    },    "contributionANP" : "0.0%",    "contributionFYC" : "0.0%",    "contributionCASESIZEFYP" : "",    "growth" : {      "AGENTS" : "0.0000",      "ACTIVENEW" : "0.0000",      "CASES" : "0.0000",      "CASESIZEFYC" : "0.0000",      "ANP" : "0.0000",      "CASESIZEFYP" : "0.0000",      "FYC" : "0.0000",      "FYP" : "0.0000",      "RECRUIT" : "0.0000",      "CASESIZEANP" : "0.0000",      "ACTIVEAGENTS" : "0.0000"    },    "code" : "7K",    "level" : "SZ",    "contributionCASES" : "",    "vsgoal" : {      "AGENTS" : "",      "ACTIVENEW" : "",      "CASES" : "",      "CASESIZEFYC" : "",      "ANP" : "",      "CASESIZEFYP" : "",      "FYC" : "",      "FYP" : "",      "RECRUIT" : "",      "CASESIZEANP" : "",      "ACTIVEAGENTS" : ""    },    "activity" : "",    "contributionCASESIZEFYC" : "",    "contributionAGENTS" : "0.0%",    "contributionACTIVENEW" : "0.0%",    "name" : "7K"  }]';
// BP.getDrilldownData(dataNew);

define(['jquery','tppl','iframe','language'], function ($,t,iframe,language) {
    var sortIndex = -1;
    var trsValue = [];
    var name_sort = 1;
    
    function createCompact(object1, object2) {
      var value1 = parseFloat(object1[1]);
      var value2 = parseFloat(object2[1]);
      if(!value1 && value1 != 0){
        value1 = -0.0001;
      }
      if(!value2 && value2 != 0){
        value2 = -0.0001;
      }
      return value2 - value1;
    }
    
    function drillDown(){
      $(".drill_name").each(function () {
          $(this).click(function () {
              iframe.loadURL("agentid:"+$(this).data("code")+":"+$(this).data("name")+':'+$(this).data("level")+':'+$(this).data("type"));
          });
      });
    }
    
    return {
      drillDownData:null,

      getDrilldownData: function (data) {
        this.drillDownData = data;
      },
       
      updateDrilldown: function () {
        var data = $.parseJSON(this.drillDownData);
        //初始化数据，如果为空则显示-
        var tempArray = [];

        for(var i=0; i<data.length;i++){
          var item = this.initData(data[i]);
          tempArray.push(item);
        }

        data = tempArray;

        var obj = {};
        obj.data = data;

        var render = tppl($("#drill_down-tmpl").html());
        var html = render(obj);
        $("#drill_tb").append(html);
    
        //change language to html
        language.changeLanguage();

        this.sortFunc(data);
      },

      initData: function(data){
        for(var item in data){
          if(item.indexOf("contribution")>=0){
            if(data[item] == ""){
              data[item] = "-";
            }else if(data[item] == "-0.0%"){
              data[item] = "0.0%";
            }
          }
        }

        return data;
      },

      sortFunc:function(data){
        var content = this;
        //get table data
        var trBody = $("#drill_tb tbody").find('tr');
        var trNum = (trBody.length)/4;
         
        for (var i = 0; i < trNum; i++) {
          trsValue[i] = [];
          trsValue[i][1] = $(".contri").eq(i).text();

          var tr = '';
          for (var j = i * 4; j < (i + 1) * 4; j++) {
            if (j == (i + 1) * 4 - 1) {
               tr += '<tr class="box">';
            } else {
              tr += '<tr>';
            }
            tr += trBody.eq(j).html();
            tr += '</tr>';
           }
           trsValue[i][2] = tr;
           trsValue[i][3] = data[i];
        }

        //sort by contribution ANP at the first time
        trsValue.sort(createCompact);
        this.add2Html(trsValue);
        this.changeData(data);
        // console.log(trsValue);
        //listen on contribution click
        var tag=1;
        $("#contriType").click(function () {
          trsValue.reverse();
          content.add2Html(trsValue);
                 
          //modify contribution data
          for(var i=0;i<trsValue.length;i++){     
            if(trsValue[i][1]){
              $(".contri").eq(i).text(trsValue[i][1]);
            }else{
              $(".contri").eq(i).text("");
            }
          }

          if(tag){
             $(this).find('img').css('transform','rotate(180deg)');
             tag = 0;
          }else{
             $(this).find('img').css('transform','rotate(0)')
             tag = 1;
          }
          name_sort = 1;
        });

        //listen on name click
        var temptrsValue;

        $("#name").click(function(){
          // console.log(temptrsValue);
          if(name_sort){
            temptrsValue = trsValue.concat(); 
            temptrsValue.sort(function(a,b){
              return a[3]["name"].localeCompare(b[3]["name"]);
            });
            name_sort = 0;
          }else{
            temptrsValue.reverse();
            name_sort = 1;
          }

          content.add2Html(temptrsValue);

          //modify compare data
          for(var i=0; i< temptrsValue.length; i++){
            if(temptrsValue[i][1]){
              $(".contri").eq(i).text(temptrsValue[i][1]);
            }else{
              $(".contri").eq(i).text("");
            }
          }

          // trsValue = temptrsValue;
        });
       },
       
      add2Html:function(data){
        $("#drill_tb tbody").empty();

        var newHtml = '';
        for (var i = 0; i < data.length; i++) {
          newHtml += data[i][2];
        }
        $("#drill_tb tbody").append(newHtml);

        drillDown();

        var level = data[0][3].level;
        var nameArray = {"R":"Region","D":"Division","Z":"Zone","SZ":"Sub Zone","G":"Group","SG":"Sub Group","AY":"Agency","AG":"Agents","CR":"Region","CD":"Division","CZ":"Zone","AE":"Sub Zone","SA":"SAC","GR":"Region","GD":"Division","GZ":"Zone","GO":"Sub Zone","GA":"GA","Building":"Building","GE":"Sub Zone"};
        $("#name").text(nameArray[level]);
      },
       
      changeData:function(data){
        var tbHeadTh = $("#drill_tb").find('tr th:gt(2)');
        var content = this;

        tbHeadTh.each(function (index) {
          $(this).click(function () {
            if(sortIndex != index){
              var contri = $(".contri");
              var type = $(this).text();
              $("#contriType").html(type+'<br><span>'+ BP.language.DRILL_CONTRIBUTION +'</span><img src="../images/sort.png">');

              type = type.toUpperCase();
              //replace &nbsp; and space
              type = type.replace(/[ ]/g, '');
              type = type.replace(/[ ]/g, '');

              if(type==="CASE" || type==="CASE/AVG.ACTIVEAGENT"){
                type = "CASES"
              }else if(type==="AVG.ACTIVEAGENT"){
                type = "ACTIVEAGENTS";
              }else if(type==="NEWRECRUITS"){
                type = 'RECRUIT';
              }else if(type==="ACTIVENEWAGENTS"){
                type = 'ACTIVENEW';
              }

              //modify compare data
              for(var i=0; i< trsValue.length; i++){
                var tem = trsValue[i][3];
                trsValue[i][1] = tem["contribution"+type];
              }

              //srot
              trsValue.sort(createCompact);
              content.add2Html(trsValue);

              //modify contribution data
              for(var i=0;i<trsValue.length;i++){
                var tem = trsValue[i][3];
                var text = tem["contribution"+type];

                if(text){
                 $(".contri").eq(i).text(text);
                }else{
                 $(".contri").eq(i).text("");
                }
              name_sort = 1;
              }
            }
            sortIndex = index;
         });
        });

        }
   }
});